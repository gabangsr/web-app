<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-900">

<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Database Manager</h1>
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h2 class="text-xl font-semibold mb-4">Add New Item</h2>
        <form id="add-item-form" class="flex space-x-4">
            <input type="text" id="item-name" placeholder="Name" required
                class="p-2 border border-gray-300 rounded-lg w-80" />
            <input type="text" id="item-description" placeholder="Description (optional)"
                class="p-2 border border-gray-300 rounded-lg w-80" />
            <input type="submit" value="Add Item"
                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 cursor-pointer" />
        </form>
    </div>
    <h2 class="text-xl font-semibold mb-4">Items List</h2>
    <table class="min-w-full table-auto bg-white rounded-lg shadow-md">
        <thead class="bg-gray-200">
            <tr>
                <th class="py-2 px-4 text-left">ID</th>
                <th class="py-2 px-4 text-left">Name</th>
                <th class="py-2 px-4 text-left">Description</th>
                <th class="py-2 px-4 text-left">Date Created</th>
                <th class="py-2 px-4 text-left">Actions</th>
            </tr>
        </thead>
        <tbody id="items-list">
        </tbody>
    </table>

</div>

<script>
let items = [];
const fetchItems = async () => {
    const itemsList = document.getElementById('items-list');
    try {
        items = await fetch('/api/items')
            .then(response => response.json())
            .catch(() => items); 
        itemsList.innerHTML = items
            .map(item => `
                <tr class="border-t">
                    <td class="py-2 px-4">${item.id}</td>
                    <td class="py-2 px-4">${item.name}</td>
                    <td class="py-2 px-4">${item.description || 'No description'}</td>
                    <td class="py-2 px-4">${item.date_created}</td>
                    <td class="py-2 px-4">
                        <button class="edit-button px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 mr-2" onclick="editItem(${item.id}, '${item.name}', '${item.description || ''}')">Edit</button>
                        <button class="delete-button px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600" onclick="deleteItem(${item.id})">Delete</button>
                    </td>
                </tr>
            `)
            .join('');
    } catch (error) {
        console.error('Error fetching items:', error);
    }
};

const getNextItemId = () => {
    if (items.length === 0) return 1;
    const highestId = Math.max(...items.map(item => item.id));
    return highestId + 1;
};

const addItem = async (name, description) => {
    try {
        const newId = getNextItemId();
        const newItem = {
            id: newId,
            name,
            description,
            date_created: new Date().toLocaleString(),
        };


        items.push(newItem);
        await fetch('/api/items', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newItem),
        });

        fetchItems();  
    } catch (error) {
        console.error('Error adding item:', error);
    }
};

const editItem = async (id, currentName, currentDescription) => {
    const name = prompt('Enter new name for the item:', currentName);
    const description = prompt('Enter new description for the item (optional):', currentDescription);
    
    if (name) {
        try {
            const response = await fetch(`/api/items/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, description })
            });
            
            if (response.ok) {
                fetchItems(); 
            } else {
                alert('Error updating item');
            }
        } catch (error) {
            console.error('Error editing item:', error);
        }
    }
};

const deleteItem = async (id) => {
    if (confirm('Are you sure you want to delete this item?')) {
        try {
            const response = await fetch(`/api/items/${id}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                fetchItems();
            } else {
                alert('Error deleting item');
            }
        } catch (error) {
            console.error('Error deleting item:', error);
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    const addItemForm = document.getElementById('add-item-form');
    const itemNameInput = document.getElementById('item-name');
    const itemDescriptionInput = document.getElementById('item-description');

    addItemForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const name = itemNameInput.value;
        const description = itemDescriptionInput.value;
        if (name) {
            addItem(name, description);
            itemNameInput.value = '';  
            itemDescriptionInput.value = '';
        }
    });

    fetchItems(); 
});
</script>

</body>
</html>
